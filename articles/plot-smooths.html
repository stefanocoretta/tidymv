<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Plot smooths from GAMs • tidymv</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Plot smooths from GAMs">
<meta property="og:description" content="tidymv">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidymv</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/plot-smooths.html">Plot smooths from GAMs</a>
    </li>
    <li>
      <a href="../articles/predict-gam.html">Get model predictions and plot them with ggplot2</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stefanocoretta/tidymv/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="plot-smooths_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Plot smooths from GAMs</h1>
                        <h4 class="author">Stefano Coretta</h4>
            
            <h4 class="date">2020-12-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stefanocoretta/tidymv/blob/master/vignettes/plot-smooths.Rmd"><code>vignettes/plot-smooths.Rmd</code></a></small>
      <div class="hidden name"><code>plot-smooths.Rmd</code></div>

    </div>

    
    
<div id="plotting-smooths" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-smooths" class="anchor"></a>Plotting smooths</h2>
<p>To illustrate how to use <code><a href="../reference/plot_smooths.html">plot_smooths()</a></code>, let’s first prepare some dummy data with a factor variable and run <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam()</a></code> on this data.</p>
<p>We need to load the following packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stefanocoretta/tidymv">tidymv</a></span><span class="op">)</span></code></pre></div>
<p>The <code>gam</code> model includes a reference smooth <code><a href="https://rdrr.io/pkg/mgcv/man/s.html">s(x2)</a></code>, a by-factor difference smooth <code><a href="https://rdrr.io/pkg/mgcv/man/s.html">s(x2, by = fac)</a></code>, and a smooth <code><a href="https://rdrr.io/pkg/mgcv/man/s.html">s(x0)</a></code>. For more flexibility and for more complex models, using <code><a href="../reference/predict_gam.html">predict_gam()</a></code> and then plotting the predicted data yourself might be helpful (see “predict-gam” vignette).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gamSim.html">gamSim</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; Factor `by' variable example</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span>
  <span class="va">y</span> <span class="op">~</span>
    <span class="va">fac</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x2</span>, by <span class="op">=</span> <span class="va">fac</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x0</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">data</span>
<span class="op">)</span></code></pre></div>
<p>We can now plot the estimated smooths for the two levels of <code>fac</code>. The function supports factors with more than 2 levels.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_smooths.html">plot_smooths</a></span><span class="op">(</span>
  model <span class="op">=</span> <span class="va">model</span>,
  series <span class="op">=</span> <span class="va">x2</span>,
  comparison <span class="op">=</span> <span class="va">fac</span>
<span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></code></pre></div>
<p><img src="plot-smooths_files/figure-html/plot-gam-1.png" width="300px" style="display: block; margin: auto;"></p>
<p>With models that transform the response scale (like Poisson and binomial models), use the <code>transform</code> argument with the function to be used for transformation as the value. Let’s first load some data and fit a Poisson GAM.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"pois_df"</span><span class="op">)</span>
<span class="va">pois_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x</span>, by <span class="op">=</span> <span class="va">fac</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">pois_df</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span></code></pre></div>
<p>We can now plot on the response scale using <code>transform = exp</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_smooths.html">plot_smooths</a></span><span class="op">(</span><span class="va">pois_gam</span>, <span class="va">x</span>, <span class="va">fac</span>, transform <span class="op">=</span> <span class="va">exp</span>, series_length <span class="op">=</span> <span class="fl">70</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></code></pre></div>
<p><img src="plot-smooths_files/figure-html/plot-pois-gam-1.png" width="300px" style="display: block; margin: auto;"></p>
</div>
<div id="plotting-a-single-smooth" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-a-single-smooth" class="anchor"></a>Plotting a single smooth</h2>
<p>It is also possible to plot a single smooth.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span>
  <span class="va">y</span> <span class="op">~</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x0</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">data</span>
<span class="op">)</span>

<span class="fu"><a href="../reference/plot_smooths.html">plot_smooths</a></span><span class="op">(</span>
  model <span class="op">=</span> <span class="va">model_2</span>,
  series <span class="op">=</span> <span class="va">x0</span>
<span class="op">)</span></code></pre></div>
<p><img src="plot-smooths_files/figure-html/gam-2-1.png" width="300px" style="display: block; margin: auto;"></p>
</div>
<div id="plotting-interactions" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-interactions" class="anchor"></a>Plotting interactions</h2>
<p>It is possible to plot models with interactions by specifying faceting with the <code>facet_terms</code> and <code>split</code> arguments.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"inter_df"</span><span class="op">)</span>
<span class="va">inter_df</span> <span class="op">&lt;-</span> <span class="va">inter_df</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    x1x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">model_inter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html">bam</a></span><span class="op">(</span>
  <span class="va">y</span> <span class="op">~</span>
    <span class="va">x1x2</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x0</span>, k <span class="op">=</span> <span class="fl">8</span>, by <span class="op">=</span> <span class="va">x1x2</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">inter_df</span>
<span class="op">)</span></code></pre></div>
<p>The <code>split</code> argument allows the user to split the factor interaction (back) into separate factors, which can be used to facet with the <code>facet_terms</code> argument. <code>split</code> takes a named list, where each object in the list is a named vector with the names of the new factors as strings (<code><a href="https://rdrr.io/r/base/c.html">c("x1", "x2")</a></code>) and the name of the factor interaction to be split as the name of this vector (<code>x1x2 = ...</code>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_smooths.html">plot_smooths</a></span><span class="op">(</span>
  model <span class="op">=</span> <span class="va">model_inter</span>,
  series <span class="op">=</span> <span class="va">x0</span>,
  comparison <span class="op">=</span> <span class="va">x1</span>,
  facet_terms <span class="op">=</span> <span class="va">x2</span>,
  split <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x1x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></code></pre></div>
<p><img src="plot-smooths_files/figure-html/plot-interactions-1.png" width="300px" style="display: block; margin: auto;"></p>
<p>You can use the <code>sep</code> argument to specify the character used for separating the factor interaction. By default is <code>"\\."</code>, which is the default character used when creating interactions with <code><a href="https://rdrr.io/r/base/interaction.html">interaction()</a></code>.</p>
<p>To plot just one or some of the facets, you should use the <code>conditions</code> argument. This argument takes a list of quosures with <code><a href="https://ggplot2.tidyverse.org/reference/tidyeval.html">quos()</a></code>. The quosures are statements like the ones used in <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code>, and you can include multiple statements separated by commas inside <code><a href="https://ggplot2.tidyverse.org/reference/tidyeval.html">quos()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_smooths.html">plot_smooths</a></span><span class="op">(</span>
  model <span class="op">=</span> <span class="va">model_inter</span>,
  series <span class="op">=</span> <span class="va">x0</span>,
  comparison <span class="op">=</span> <span class="va">x1</span>,
  facet_terms <span class="op">=</span> <span class="va">x2</span>,
  conditions <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/tidyeval.html">quos</a></span><span class="op">(</span><span class="va">x2</span> <span class="op">==</span> <span class="st">"b"</span><span class="op">)</span>,
  split <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x1x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></code></pre></div>
<p><img src="plot-smooths_files/figure-html/plot-interactions-2-1.png" width="300px" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_smooths.html">plot_smooths</a></span><span class="op">(</span>
  model <span class="op">=</span> <span class="va">model_inter</span>,
  series <span class="op">=</span> <span class="va">x0</span>,
  comparison <span class="op">=</span> <span class="va">x1</span>,
  facet_terms <span class="op">=</span> <span class="va">x2</span>,
  conditions <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/tidyeval.html">quos</a></span><span class="op">(</span><span class="va">x1</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,
  split <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x1x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></code></pre></div>
<p><img src="plot-smooths_files/figure-html/plot-interactions-3-1.png" width="300px" style="display: block; margin: auto;"></p>
<p>If you need more flexibility (for example, if you’d like to be able to select variables as aesthetics rather than facets), the most straightforward solution is to get the predictions of the model with <code><a href="../reference/get_gam_predictions.html">get_gam_predictions()</a></code> and use the standard ggplot2 functions.</p>
<p>To get confidence intervals, <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon()</a></code> must have a <code>group</code> aesthetic set to the index column <code>.idx</code>, which is automatically generated by <code><a href="../reference/get_gam_predictions.html">get_gam_predictions()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_gam_predictions.html">get_gam_predictions</a></span><span class="op">(</span><span class="va">model_inter</span>, <span class="va">x0</span>, split <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x1x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">preds</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">CI_lower</span>, ymax <span class="op">=</span> <span class="va">CI_upper</span>, fill <span class="op">=</span> <span class="va">x1</span>, group <span class="op">=</span> <span class="va">.idx</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">x1</span>, linetype <span class="op">=</span> <span class="va">x2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="plot-smooths_files/figure-html/get-gam-pred-1.png" width="300px" style="display: block; margin: auto;"></p>
</div>
<div id="plotting-the-difference-smooth" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-the-difference-smooth" class="anchor"></a>Plotting the difference smooth</h2>
<p>The difference smooth can be plotted with <code><a href="../reference/plot_difference.html">plot_difference()</a></code>. The difference smooth is the difference between the smooths of two conditions (two levels in a factor). Portions of the difference smooth confidence interval that do not include 0 are shaded in red.</p>
<p>The following is a difference smooth comparing the two levels of the <code>fac</code> term in the Poisson GAM above.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_difference.html">plot_difference</a></span><span class="op">(</span>
  <span class="va">pois_gam</span>,
  series <span class="op">=</span> <span class="va">x</span>,
  difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fac <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="plot-smooths_files/figure-html/plot-diff-model-1.png" width="300px" style="display: block; margin: auto;"></p>
<p>To plot a difference smooth from a model with factor interactions, it is possible to specify the two levels to compare from the factor interaction (the argument <code>split</code> is not supported in <code><a href="../reference/plot_difference.html">plot_difference()</a></code>).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_difference.html">plot_difference</a></span><span class="op">(</span>
  <span class="va">model_inter</span>,
  <span class="va">x0</span>,
  difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x1x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2.a"</span>, <span class="st">"3.a"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="plot-smooths_files/figure-html/plot-diff-inter-1-1.png" width="300px" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_difference.html">plot_difference</a></span><span class="op">(</span>
  <span class="va">model_inter</span>,
  <span class="va">x0</span>,
  difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x1x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1.b"</span>, <span class="st">"2.b"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><img src="plot-smooths_files/figure-html/plot-diff-inter-3-1.png" width="300px" style="display: block; margin: auto;"></p>
<p>If you would rather get a tibble with the difference smooths and plot it yourself, you can use <code><a href="../reference/get_smooths_difference.html">get_smooths_difference()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inter_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_smooths_difference.html">get_smooths_difference</a></span><span class="op">(</span><span class="va">model_inter</span>, <span class="va">x0</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x1x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2.a"</span>, <span class="st">"3.a"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">inter_diff</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">difference</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"#8f5f3f"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">CI_lower</span>, ymax <span class="op">=</span> <span class="va">CI_upper</span>, fill <span class="op">=</span> <span class="va">sig_diff</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">sig_diff</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e35760"</span>, <span class="st">"#6f849c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e35760"</span>, <span class="st">"#6f849c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"significant"</span>, fill <span class="op">=</span> <span class="st">"significant"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></code></pre></div>
<p><img src="plot-smooths_files/figure-html/get-smooths-diff-1.png" width="300px" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Stefano Coretta.</p>
</div>

<div class="pkgdown">
  <p>Made with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1, using <a href="https://preferably.amirmasoudabdol.name/?source=footer">preferably</a> template.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
