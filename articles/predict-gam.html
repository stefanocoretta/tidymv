<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Get model predictions and plot them with ggplot2 • tidymv</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get model predictions and plot them with ggplot2">
<meta property="og:description" content="tidymv">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidymv</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/plot-smooths.html">Plot smooths from GAMs</a>
    </li>
    <li>
      <a href="../articles/predict-gam.html">Get model predictions and plot them with ggplot2</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stefanocoretta/tidymv/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
        
        


      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="predict-gam_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get model predictions and plot them with ggplot2</h1>
                        <h4 class="author">Stefano Coretta</h4>
            
            <h4 class="date">2021-01-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stefanocoretta/tidymv/blob/master/vignettes/predict-gam.Rmd"><code>vignettes/predict-gam.Rmd</code></a></small>
      <div class="hidden name"><code>predict-gam.Rmd</code></div>

    </div>

    
    
<p>While <code><a href="../reference/plot_smooths.html">plot_smooths()</a></code> offers a streamlined way of plotting predicted smooths from a GAM model (see <code><a href="../articles/plot-smooths.html">vignette("plot-smooths", package = "tidymv")</a></code>), it is too constrained for other more complex cases.</p>
<p>The most general solution is to get the predicted values of the outcome variable according to all the combinations of terms in the model and use this dataframe for plotting. This method grants the user maximum control over what can be plotted and how to transform the data (if necessary).</p>
<p>I will illustrate how to use the function <code><a href="../reference/predict_gam.html">predict_gam()</a></code> to create a prediction dataframe and how this dataframe can be used for plotting different cases.</p>
<p>Let’s load the necessary packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stefanocoretta/tidymv">tidymv</a></span><span class="op">)</span></code></pre></div>
<div id="smooths" class="section level2">
<h2 class="hasAnchor">
<a href="#smooths" class="anchor"></a>Smooths</h2>
<p>First of all let’s generate some simulated data and create a GAM model with a factor <code>by</code> variable.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gamSim.html">gamSim</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">400</span><span class="op">)</span>
<span class="co">#&gt; Factor `by' variable example</span>

<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span>
  <span class="va">y</span> <span class="op">~</span>
    <span class="va">fac</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x2</span>, by <span class="op">=</span> <span class="va">fac</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">data</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family: gaussian </span>
<span class="co">#&gt; Link function: identity </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Formula:</span>
<span class="co">#&gt; y ~ fac + s(x2, by = fac)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parametric coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)   1.2219     0.1634   7.478 5.17e-13 ***</span>
<span class="co">#&gt; fac2         -1.7395     0.2376  -7.322 1.44e-12 ***</span>
<span class="co">#&gt; fac3          2.2505     0.2301   9.779  &lt; 2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Approximate significance of smooth terms:</span>
<span class="co">#&gt;              edf Ref.df      F p-value    </span>
<span class="co">#&gt; s(x2):fac1 2.750  3.426  3.749 0.00763 ** </span>
<span class="co">#&gt; s(x2):fac2 2.738  3.403 41.046 &lt; 2e-16 ***</span>
<span class="co">#&gt; s(x2):fac3 7.140  8.195 35.734 &lt; 2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; R-sq.(adj) =  0.643   Deviance explained = 65.6%</span>
<span class="co">#&gt; GCV = 3.6879  Scale est. = 3.5438    n = 400</span></code></pre></div>
<p>We can extract the predicted values with <code><a href="../reference/predict_gam.html">predict_gam()</a></code>. The predicted values of the outcome variable are in the column <code>fit</code>, while <code>fit.se</code> reports the standard error of the predicted values.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_gam.html">predict_gam</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>
<span class="va">model_p</span>
<span class="co">#&gt; # A tibble: 150 x 4</span>
<span class="co">#&gt;    fac        x2    fit se.fit</span>
<span class="co">#&gt;    &lt;fct&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     0.00134  1.02   0.546</span>
<span class="co">#&gt;  2 2     0.00134 -2.80   0.508</span>
<span class="co">#&gt;  3 3     0.00134 -1.70   0.801</span>
<span class="co">#&gt;  4 1     0.0217   1.04   0.487</span>
<span class="co">#&gt;  5 2     0.0217  -2.72   0.454</span>
<span class="co">#&gt;  6 3     0.0217  -0.616  0.612</span>
<span class="co">#&gt;  7 1     0.0421   1.06   0.435</span>
<span class="co">#&gt;  8 2     0.0421  -2.65   0.407</span>
<span class="co">#&gt;  9 3     0.0421   0.477  0.484</span>
<span class="co">#&gt; 10 1     0.0625   1.08   0.390</span>
<span class="co">#&gt; # … with 140 more rows</span></code></pre></div>
<p>Now plotting can be done with <code>ggplot2</code>. The convenience function <code><a href="../reference/geom_smooth_ci.html">geom_smooth_ci()</a></code> can be used to plot the predicted smooths with confidence intervals.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_p</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x2</span>, <span class="va">fit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_smooth_ci.html">geom_smooth_ci</a></span><span class="op">(</span><span class="va">fac</span><span class="op">)</span></code></pre></div>
<p><img src="predict-gam_files/figure-html/model-plot-1.png" width="300px" style="display: block; margin: auto;"></p>
</div>
<div id="surface-smooths" class="section level2">
<h2 class="hasAnchor">
<a href="#surface-smooths" class="anchor"></a>Surface smooths</h2>
<p>Now let’s plot a model that has a tensor product interaction term (<code><a href="https://rdrr.io/pkg/mgcv/man/te.html">ti()</a></code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span>
  <span class="va">y</span> <span class="op">~</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html">ti</a></span><span class="op">(</span><span class="va">x2</span>, <span class="va">f1</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">data</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_2</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family: gaussian </span>
<span class="co">#&gt; Link function: identity </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Formula:</span>
<span class="co">#&gt; y ~ s(x2) + s(f1) + ti(x2, f1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parametric coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)   1.4766     0.1527    9.67   &lt;2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Approximate significance of smooth terms:</span>
<span class="co">#&gt;             edf Ref.df     F p-value   </span>
<span class="co">#&gt; s(x2)     1.477  1.871 1.005 0.36103   </span>
<span class="co">#&gt; s(f1)     1.000  1.000 1.279 0.25870   </span>
<span class="co">#&gt; ti(x2,f1) 1.000  1.000 7.421 0.00673 **</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; R-sq.(adj) =  0.0662   Deviance explained = 7.43%</span>
<span class="co">#&gt; GCV = 9.3692  Scale est. = 9.2644    n = 400</span></code></pre></div>
<p>Let’s get the prediction dataframe and produce a contour plot. We can adjust labels and aesthetics using the usual <code>ggplot2</code> methods.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_2_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_gam.html">predict_gam</a></span><span class="op">(</span><span class="va">model_2</span><span class="op">)</span>
<span class="va">model_2_p</span>
<span class="co">#&gt; # A tibble: 2,500 x 4</span>
<span class="co">#&gt;         x2      f1    fit se.fit</span>
<span class="co">#&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 0.00134 0.00125 -1.35   0.585</span>
<span class="co">#&gt;  2 0.0217  0.00125 -1.27   0.574</span>
<span class="co">#&gt;  3 0.0421  0.00125 -1.19   0.587</span>
<span class="co">#&gt;  4 0.0625  0.00125 -1.12   0.620</span>
<span class="co">#&gt;  5 0.0829  0.00125 -1.04   0.670</span>
<span class="co">#&gt;  6 0.103   0.00125 -0.962  0.729</span>
<span class="co">#&gt;  7 0.124   0.00125 -0.887  0.795</span>
<span class="co">#&gt;  8 0.144   0.00125 -0.813  0.864</span>
<span class="co">#&gt;  9 0.164   0.00125 -0.740  0.933</span>
<span class="co">#&gt; 10 0.185   0.00125 -0.668  1.00 </span>
<span class="co">#&gt; # … with 2,490 more rows</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_2_p</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x2</span>, <span class="va">f1</span>, z <span class="op">=</span> <span class="va">fit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">fit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">geom_contour</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html">scale_fill_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></code></pre></div>
<p><img src="predict-gam_files/figure-html/model-2-plot-1.png" width="300px" style="display: block; margin: auto;"></p>
</div>
<div id="smooths-at-specified-values-of-a-continuous-predictor" class="section level2">
<h2 class="hasAnchor">
<a href="#smooths-at-specified-values-of-a-continuous-predictor" class="anchor"></a>Smooths at specified values of a continuous predictor</h2>
<p>To plot the smooths across a few values of a continuous predictor, we can use the <code>values</code> argument in <code><a href="../reference/predict_gam.html">predict_gam()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/predict_gam.html">predict_gam</a></span><span class="op">(</span><span class="va">model_2</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>f1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x2</span>, <span class="va">fit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_smooth_ci.html">geom_smooth_ci</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span></code></pre></div>
<p><img src="predict-gam_files/figure-html/model-2-values-1.png" width="300px" style="display: block; margin: auto;"></p>
</div>
<div id="exclude-terms-like-random-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#exclude-terms-like-random-effects" class="anchor"></a>Exclude terms (like random effects)</h2>
<p>It is possible to exclude terms when predicting values by means of the <code>exclude_terms</code> argument. This can be useful when there are random effects, like in the following model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_re</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, rand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">rand</span><span class="op">)</span><span class="op">)</span>

<span class="va">model_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span>
  <span class="va">y</span> <span class="op">~</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">x2</span>, <span class="va">rand</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">data_re</span>
<span class="op">)</span>
<span class="co">#&gt; Warning in gam.side(sm, X, tol = .Machine$double.eps^0.5): model has repeated 1-</span>
<span class="co">#&gt; d smooths of same variable.</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_3</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family: gaussian </span>
<span class="co">#&gt; Link function: identity </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Formula:</span>
<span class="co">#&gt; y ~ s(x2) + s(x2, rand, bs = "fs", m = 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Parametric coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)   1.5043     0.2436   6.175 1.67e-09 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Approximate significance of smooth terms:</span>
<span class="co">#&gt;              edf Ref.df     F  p-value    </span>
<span class="co">#&gt; s(x2)      4.169  5.079 4.426 0.000641 ***</span>
<span class="co">#&gt; s(x2,rand) 5.755 35.000 0.327 0.024554 *  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; R-sq.(adj) =  0.0914   Deviance explained = 11.4%</span>
<span class="co">#&gt; GCV = 9.2673  Scale est. = 9.0142    n = 400</span></code></pre></div>
<p><code>exclude_terms</code> takes a character vector of term names, as they appear in the output of <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> (rather than as they are specified in the model formula). For example, to remove the term <code><a href="https://rdrr.io/pkg/mgcv/man/s.html">s(x2, fac, bs = "fs", m = 1)</a></code>, <code>"s(x2,fac)"</code> should be used since this is how the summary output reports this term. The output still contains the excluded columns. The predicted values of the outcome variable are not affected by the value the excluded terms (the predicted values are repeated for each value of the excluded terms). In other words, the coefficients for the excluded terms are set to 0 when predicting. We can filter the predicted dataset to get unique predicted values by choosing any value or level of the excluded terms.\footnote{Alternatively, we can use <code>splice()</code>: <code>group_by(a) %&gt;% splice(1)</code>. See <code>?splice</code>.}</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/predict_gam.html">predict_gam</a></span><span class="op">(</span><span class="va">model_3</span>, exclude_terms <span class="op">=</span> <span class="st">"s(x2,rand)"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">rand</span> <span class="op">==</span> <span class="st">"a"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x2</span>, <span class="va">fit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_smooth_ci.html">geom_smooth_ci</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="predict-gam_files/figure-html/model-3-plot-1.png" width="300px" style="display: block; margin: auto;"></p>
<p>To speed up the calculation of the predictions when excluding terms, it is helpful to select a single value for the unnecessary terms using the <code>values</code> argument, rather than filtering with <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>. As with <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, any value of the excluded variable can be used. If the value is <code>NULL</code>, the first value/level of the term is automatically selected (in the example below, <code>values = list(rand = NULL)</code> and <code>values = list(rand = "a")</code> would be equivalent).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/predict_gam.html">predict_gam</a></span><span class="op">(</span><span class="va">model_3</span>, exclude_terms <span class="op">=</span> <span class="st">"s(x2,rand)"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>rand <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x2</span>, <span class="va">fit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_smooth_ci.html">geom_smooth_ci</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="predict-gam_files/figure-html/model-3-plot-2-1.png" width="300px" style="display: block; margin: auto;"></p>
<p>Of course, it is possible to plot the predicted values of random effects if we wish to do so. In the following example, the random effect <code>rand</code> is not excluded when predicting, and it is used to facet the plot.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/predict_gam.html">predict_gam</a></span><span class="op">(</span><span class="va">model_3</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x2</span>, <span class="va">fit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_smooth_ci.html">geom_smooth_ci</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">rand</span><span class="op">)</span></code></pre></div>
<p><img src="predict-gam_files/figure-html/model-3-rand-1.png" width="300px" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Stefano Coretta.</p>
</div>

<div class="pkgdown">
  <p>Made with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1, using <a href="https://preferably.amirmasoudabdol.name/?source=footer">preferably</a> template.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
